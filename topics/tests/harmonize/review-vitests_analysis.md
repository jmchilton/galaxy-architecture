# Harmonization Analysis: review-vitests

## Information in Command NOT in Docs

The static command at `review/static_commands/gx-vitest-review.md` contains:

- [ ] **Inline best practices** - The static command embeds specific code examples directly:
  - "Test Behavior, Not Implementation" with concrete good/bad examples
  - "Test Composition API Components Properly" with mount() example
  - "Test Options API Components" warning against `wrapper.vm`
  - "Test Pinia Stores in Isolation" with complete setup pattern
  - "Use `flushPromises()` for Async Operations"
  - "Keep Tests Focused and Independent" examples
  - "Use Descriptive Test Names" good/bad examples
  - "Clean Up After Tests" with beforeEach/afterEach pattern
  - "AI-Specific Guidelines" with 6 specific points

- [ ] **"Who you are" persona framing** - Static command defines reviewer persona:
  - "skeptical of autogenerated unit test code that was never red"
  - "happy to do little experiments where you tweak tests"

- [ ] **Specific running instructions** - "Galaxy unit tests can be run via 'yarn test'"

## Information in Docs NOT in Command

The documentation in content.yaml contains extensive material the command doesn't reference:

- [ ] **Test file structure** (`es6-test-structure`) - Explains `.test.ts` placement, standard imports
- [ ] **Galaxy testing infrastructure** (`es6-localvue`) - `getLocalVue()`, test data factories
- [ ] **Test data factories** (`es6-test-data-factories`) - `getFakeRegisteredUser()`, etc.
- [ ] **MSW API mocking** (`es6-msw`) - `useServerMock()` pattern with OpenAPI-MSW
- [ ] **shallowMount vs mount** (`es6-shallow-mount`) - Preference for shallowMount, table comparison
- [ ] **Mount wrapper factories** (`es6-mount-wrapper`) - Reusable async mount function pattern
- [ ] **Selector constants & events** (`es6-selectors`) - SELECTORS object pattern, emitted events testing
- [ ] **Pinia store testing** (`es6-pinia`) - createTestingPinia, stubActions patterns
- [ ] **Async operations** (`es6-async`) - flushPromises() vs nextTick() distinction
- [ ] **Running tests** (`es6-running-tests`) - Watch mode, filtering by name/path

**Agent-context blocks (designed for agentic operations):**
- [ ] **`es6-red-flags`** - 8 specific anti-patterns to watch for during review
- [ ] **`es6-test-verification`** - Techniques to verify tests actually test something
- [ ] **`es6-ai-guidelines`** - Signs of low-value AI-generated tests, preferred approach

## Gaps in Operation Prompt

The metadata.yaml prompt contains a TODO:

```
## Best Practices

TODO: Summarize best practices from at least these content blocks: es6-best-practices, es6-best-practices-examples,
es6-red-flags, es6-test-verification, es6-ai-guidelines.
```

This TODO indicates the prompt *expects* the generated command to pull content from the docs, but:

- [ ] The TODO marker isn't being honored - static command was written manually with embedded content
- [ ] No mechanism tells the generator which blocks are relevant for this operation
- [ ] The `agent-context` blocks in content.yaml are specifically designed for this but aren't being used
- [ ] The prompt doesn't explicitly instruct the agent to read `related_code_paths` for Galaxy-specific patterns

## Command Comparison

| Dimension | Original (static) | Generated (from docs) | Winner |
|-----------|----------|-----------|--------|
| Specificity of code patterns | Good - has concrete examples | Better - uses Galaxy-specific patterns (MSW, localVue, test-data factories) | Generated |
| Coverage of anti-patterns | 6 AI guidelines + implicit | 8 explicit red flags + 3 verification techniques + AI guidelines | Generated |
| Actionability of guidance | Medium - describes what to look for | Higher - includes "comment out implementation" verification steps | Generated |
| Use of related_code_paths | None - just "yarn test" | Lists specific paths: `client/tests/vitest/helpers.ts`, test-data, mocks | Generated |
| Alignment with docs | Manual copy, drifted | Directly synthesized from content.yaml blocks | Generated |
| Galaxy infrastructure coverage | Missing | Includes LocalVue, mount factories, SELECTORS pattern, Pinia testing | Generated |
| Composition vs Options API | Has both patterns | Only mentions shallowMount preference | Original (slight) |

## Key Differences

1. **Generated command is ~2x longer (295 lines vs ~160)** - includes more Galaxy-specific infrastructure patterns
2. **Generated uses agent-context blocks** - pulls from `es6-red-flags`, `es6-test-verification`, `es6-ai-guidelines` as intended
3. **Static command has slightly different phrasing** - "never red" vs "never failing" (semantically equivalent)
4. **Generated includes related_code_paths section** - points to actual Galaxy testing infrastructure
5. **Generated has Galaxy Testing Infrastructure section** - LocalVue, test factories, MSW, Pinia patterns
6. **Static has Composition/Options API split** - generated doesn't explicitly cover Options API pattern
