topic_id: dependency-injection
title: Dependency Injection in Galaxy
training:
  tutorial_number: 6
  subtitle: The architecture of connecting Galaxy components.
  questions:
    - What is dependency injection?
    - Why does Galaxy use dependency injection?
    - How do I use DI in controllers and tasks?
  objectives:
    - Understand the problems with the `app` god object
    - Learn about type-based dependency injection
    - Use DI in controllers and tasks
    - Understand the benefits of typing
  key_points:
    - "`app` was a god object that knew/did too much"
    - "Interfaces break circular dependencies"
    - "Type-based DI with Lagom simplifies construction"
    - "DI works uniformly across FastAPI, WSGI controllers, and tasks"
    - "Dependencies should form a DAG"
  time_estimation: 15m
  previous_to: frameworks
  continues_to: tasks
  prerequisites:
    - architecture-frameworks

# Sphinx documentation metadata
sphinx:
  section: Architecture
  subsection: Core Patterns
  level: intermediate  # beginner | intermediate | advanced
  toc_depth: 2

# Galaxy Hub metadata
hub:
  audience: [developers, contributors]
  tags: [architecture, design-patterns, dependency-injection]

# Cross-references
# Note: Some related topics may not exist yet (e.g., application-components, frameworks)
# These can be added when those topics are migrated
related_topics: []
related_code_paths:
  - lib/galaxy/di/
  - lib/galaxy/structured_app.py
  - lib/galaxy/app.py
  - lib/galaxy/managers/
  - lib/galaxy/webapps/galaxy/api/
  - lib/galaxy/celery/tasks.py

# Contributors
contributors:
  - jmchilton

# Agentic operations
agentic_operations:
  - name: refactor-to-di
    prompt: "Refactor a Galaxy component to use dependency injection instead of the app god object"
    type: claude-slash-command
  - name: review-di
    prompt: |
      Perform a Python code review on the provided code. Accept input in any of following forms:
      1. A working directory path (analyze git diff in that directory)
      2. A Git commit reference (analyze changes in that commit)
      3. A list of Python file paths (analyze those files)
      4. A planning document (analyze the Python files in the plan)    

      Review the code and ensure it follows best practices for dependency injection in Galaxy, including:
      1. Avoid using FastAPI style injection - preferring Galaxy-style DI injection using Lagom and typing based injection.
      2. Ensure dependencies in the service and manager layers are properly defined and injected via constructors and not via ``app`` access
         where it makes sense.
      3. Avoid creation of properties on ``app`` if possible.

    type: claude-slash-command

# Claude context
claude:
  priority: high  # How important for dev questions
  focus_areas:
    - Dependency injection patterns
    - Manager initialization
    - Testing with injected dependencies
