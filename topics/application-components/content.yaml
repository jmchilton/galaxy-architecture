- type: slide
  id: this-section-will-talk-about-that-mana
  heading: ''
  class: center
  content: '![This section will talk about that manager layer and what lies below](../../images/asgi_app.plantuml.svg)'
- type: slide
  id: there-are-many-ways-to-describe-and-visu
  heading: ''
  content: |-
    There are many ways to describe and visualize the Galaxy server architecture,
    one is to imagine the Galaxy database as the ultimate source for Galaxy "stuff"
    and the API controllers as the ultimate sink.

    In this architecture imagining of Galaxy, managers are the layer meant to
    mediate all controller interactions (and isolate the backend from the web
    framework) while the model layer is meant to mediate all database interactions
    (and isolate the backend from database internals).
- type: slide
  id: models-and-managersimagescore
  heading: ''
  class: center
  content: '![Models and Managers](../../images/core_models_managers.plantuml.svg)'
- type: slide
  id: services
  heading: Services
  content: |-
    Handle API and web processing details of requests and responses at a high-level.

    Thin layer below the controllers to shield applciation logic from FastAPI internals.

    In practice, it is totally fine to skip this layer and have FastAPI controllers talk directly
    to managers. Also in practice, there are many places where the controller or service layers
    are thicker than they should be - and these are anti-patterns that shouldn't be followed.
  class: enlarge150
- type: slide
  id: managers
  heading: Managers
  content: |-
    High-level business logic that ties all of these components together.

    Controllers should ideally be thin wrappers around actions defined in managers.

    Whenever a model requires more than just the database, the operation should be defined
    in a manager instead of in the model.
  class: enlarge150
- type: slide
  id: managers-some-key-files
  heading: Managers - Some Key Files
  class: center
  content: '![Key Managers](../../images/core_files_managers.mindmap.plantuml.svg)'
- type: slide
  id: managers-some-helpers
  heading: Managers - Some Helpers
  class: center
  content: '![Manager Helpers](../../images/core_files_managers_helpers.mindmap.plantuml.svg)'
- type: slide
  id: galaxy-models
  heading: Galaxy Models
  content: |-
    - Database interactions powered by SQLAlchemy - https://www.sqlalchemy.org/.
    - Galaxy doesn't think in terms of "rows" but "objects".
    - Classes for Galaxy model objects defined in `lib/galaxy/model/__init__.py`.
    - Classes mapped to database objects in same module via "declarative mapping".
      - Classes/attributes mapped to tables/columns
      - Associations between classes mapped to relationships between tables
- type: slide
  id: sqlalchemy-architectureimages
  heading: ''
  class: center
  content: '![SQLAlchemy Architecture](../../images/sqla_arch_small.png)'
- type: slide
  id: galaxy-database-schema-migrations
  heading: Galaxy Database Schema Migrations
  content: |-
    - Automated execution of incremental, reversible changes to the database schema.
    - Performed to update or revert the database schema to a newer or older version.
    - Powered by Alembic - https://alembic.sqlalchemy.org/.
      - (as of 22.05; prior to that by SQLAlchemy Migrate)
    - Each file in `lib/galaxy/model/migrations/alembic/versions_gxy` represents a migration description
      - `e7b6dcb09efd_create_gxy_branch.py`
      - `6a67bf27e6a6_deferred_data_tables.py`
      - `b182f655505f_add_workflow_source_metadata_column.py`
- type: slide
  id: more-on-schema-migrations
  heading: More on Schema Migrations
  content: |-
    - Great documentation in code README - `lib/galaxy/model/migrations/README.md`
      - Admin perspective on how to migrate databases forward and revert on problems.
      - Developer persepctive on how to add new revisions.
    - Galaxy's data model is split into the galaxy model and the legacy install model:
      - Persisted in one combined database or two separate databases
      - Represented by 2 migration branches: "gxy" and "tsi"
    - Schema changes defined in revision modules:
      - `lib/galaxy/model/migrations/alembic/versions_gxy` (gxy branch: galaxy model)
      - `lib/galaxy/model/migrations/alembic/versions_tsi` (tsi branch: legacy install model)
- type: slide
  id: database-diagram
  heading: Database Diagram
  class: center
  content: |-
    ![Galaxy Schema](../../images/galaxy_schema.png)

    https://galaxyproject.org/admin/internals/data-model/
- type: slide
  id: hdaimageshdasvg
  heading: ''
  class: center
  content: |-
    ![HDA foor bar...](../../images/hda.svg)
- type: slide
  id: hda-datasetimageshda-dataset
  heading: ''
  class: center
  content: '![HDA Dataset](../../images/hda_dataset.plantuml.svg)'
- type: slide
  id: dataset-metadata
  heading: Dataset Metadata
  content: |-
    - Typed key-value pairs attached to HDA.
    - Keys and types defined at the datatype level.
    - Can be used by tools to dynamically control the tool form.

    ???
- type: slide
  id: hdas-and-hdcasimageshda-hdca
  heading: ''
  class: center
  content: '![HDAs and HDCAs](../../images/hda_hdca.plantuml.svg)'
- type: slide
  id: workflowsimagesworkflow-defin
  heading: ''
  class: center
  content: '![Workflows](../../images/workflow_definition.svg)'
- type: slide
  id: workflow-runningimagesworkflo
  heading: ''
  class: center
  content: '![Workflow Running](../../images/workflow_run.svg)'
- type: slide
  id: librariesimageslibrariessvg
  heading: ''
  class: center
  content: '![Libraries](../../images/libraries.svg)'
- type: slide
  id: library-permissionsimageslibr
  heading: ''
  class: center
  content: '![Library Permissions](../../images/library_permissions.svg)'
